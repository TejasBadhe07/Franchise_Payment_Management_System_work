<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Dashboard</title>
    <link rel="stylesheet" href="../css/worker_dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>Payment Management</h3>
            </div>
            <ul class="nav-links">
                <li><a href="#" class="active" id="tasks-link"><i class="fas fa-tasks"></i> Tasks</a></li>
                <!-- <li><a href="#" class="active" id="payments-link"><i class="fas fa-money-bill-wave"></i> Payments</a></li> -->
                <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content" >
            <header class="dashboard-header">
                <h2>Worker Dashboard</h2>

                <!-- Tasks Section -->
                <section class="content-area" id="tasks-content" style="display: none;">
                    <section class="tasks">
                        <h2>Your Tasks</h2>

                        <!-- Final Submission -->

                        <div class="task-card" id="task-list">
                            <button><strong>Submit</strong></button>
                            <div class="task-card">
                                <h3>Final Submission</h3>
                                <div>
                                    <h4>Old Points </h4>
                                    <h4>New Points: <span><strong>{{ total_panel_points }}</strong></span></h4>
                                </div>

                                <div>
                                    <h4>Old Balance</h4>
                                    <h4>New Balance: <span><strong>{{ new_balance }}</strong></span></h4>
                                </div>

                                <h4>Profit <span><strong>{{ profit }}</strong></span></h4>
                                <h4>Plus Minus <span><strong>{{ plus_or_minus }}</strong></span></h4>

                            </div>
                        </div>
                        
                        <!-- Panel -->

                        <div class="task-card">
                            <div class="task-card-panel">
                                <h3>Panel</h3>
                                <button class="add-panel-btn" id="open-add-panel-dialog">Add</button>
                                <button class="delete-panel-btn" id="open-delete-panel-dialog">Delete</button>
                            </div>
                            <table class="panel-table">
                                <thead>
                                    <tr>
                                        <th>Panel Name</th>
                                        <th>Points</th>
                                        <th>Update Points</th>
                                    </tr>
                                </thead>
                                <tbody id="panel-table-body">
                                    {% for panel in panels %}
                                    <tr>
                                        <td>{{ panel.panel_name }}</td>
                                        <td>{{ panel.points }}</td>
                                        <td>
                                            <button class="update-points-btn" data-panel="{{ panel.panel_name }}">Update Points</button>
                                            <button class="add-withdraw-points-btn" data-panel="{{ panel.panel_name }}">Add/Withdraw Points</button>
                                        </td>                                        
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td><strong>Total</strong></td>
                                        <td><strong>{{ total_panel_points }}</strong></td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>                            
                        </div>

                        <!-- Payments -->

                        <div class="task-card" class="content-area" id="payments-content">
                            <div class="task-card-expenses" class="payment-management">
                                <h2>Manage Bank Accounts</h2>
                                <div id="account-list"></div>
                                <button id="add-account-btn" class="action-button">Add New Account</button>
                                <button id="delete-account-btn" class="action-button">Delete Account</button>
                            </div>

                            <div class="task-card-expenses" class="payment-history">
                                <h2>Payment History</h2>
                                <table class="panel-table">
                                    <thead>
                                        <tr>
                                            <th>Account Holder Name</th>
                                            <th>Bank Name</th>
                                            <th>Current Balance</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="account-table-body">
                                        {% for account in accounts %}
                                        <tr>
                                            <td>{{ account.account_name }}</td>
                                            <td>{{ account.bank_name }}</td>
                                            <td>{{ account.amount }}</td>
                                            <td><button class="update-balance-btn" data-id="{{ account.id }}">Update Balance</button></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="2"><strong>Total</strong></td>
                                            <td><strong>{{ total_account_balance }}</strong></td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>

                        <!-- Expenses -->
                        <div class="task-card">
                            <div class="task-card-expenses">
                                <h3>Other Expenses</h3>
                                <button class="add-task-btn" id="open-add-expense-dialog">Add</button>
                                <button class="delete-task-btn" id="open-delete-expense-dialog">Delete</button>
                            </div>
                            <table class="panel-table">
                                <thead>
                                    <tr>
                                        <th>Expense Category</th>
                                        <th>Amount</th>
                                        <th>Sent/Received</th>
                                    </tr>
                                </thead>
                                <tbody id="expense-table-body">
                                    {% for expense in expenses %}
                                    <tr>
                                        <td>{{ expense.category }}</td>
                                        <td>{{ expense.amount }}</td>
                                        <td>{{ expense.transaction_type }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td><strong>Total Sent</strong></td>
                                        <td><strong>{{ total_sent }}</strong></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total Received</strong></td>
                                        <td><strong>{{ total_received }}</strong></td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </section>
                </section>

                
                <!-- Add Panel Dialog -->
                <div id="add-panel-dialog" class="dialog">
                    <div class="dialog-content">
                        <h3>Add Panel</h3>
                        <label for="panel-name">Panel Name:</label>
                        <input type="text" id="panel-name">
                        <label for="panel-points">Points:</label>
                        <input type="number" id="panel-points">
                        <div class="dialog-buttons">
                            <button id="save-panel-btn">Save</button>
                            <button id="cancel-add-panel-btn">Cancel</button>
                        </div>
                    </div>
                </div>
                
                <!-- Delete Panel Dialog -->
                <div id="delete-panel-dialog" class="dialog">
                    <div class="dialog-content">
                        <h3>Delete Panel</h3>

                        <!--Add Panel Dropdown Here -->
                        <label for="delete-panel-select">Select Panel to Delete:</label>
                        <select id="delete-panel-select">
                            {% for panel in panels %}
                                <option value="{{ panel.id }}">{{ panel.panel_name }}</option>
                            {% endfor %}
                        </select>

                        <div class="dialog-buttons">
                            <button id="delete-panel-btn">Delete</button>
                            <button id="cancel-delete-panel-btn">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Add Expense Dialog -->
                <div id="add-expense-dialog" class="dialog">
                    <div class="dialog-content">
                        <h3>Add Expense</h3>
                        <label for="expense-name">Category Name:</label>
                        <input type="text" id="expense-name">
                        <label for="expense-amount">Amount:</label>
                        <input type="number" id="expense-amount">
                        
                        <!-- Radio Buttons for Transaction Type -->
                        <div>
                            <input type="radio" id="sent" name="transaction-type" value="Sent" checked>
                            <label for="sent">Sent</label>
                            <input type="radio" id="received" name="transaction-type" value="Received">
                            <label for="received">Received</label>
                        </div>

                        <div class="dialog-buttons">
                            <button id="save-expense-btn">Save</button>
                            <button id="cancel-add-expense-btn">Cancel</button>
                        </div>
                    </div>
                </div>
                
    
                <!-- Delete Expense Dialog -->
                <div id="delete-expense-dialog" class="dialog">
                    <div class="dialog-content">
                        <h3>Delete Expense</h3>

                        <!--Add Expense Dropdown Here -->
                        <label for="delete-expense-select">Select Expense to Delete:</label>
                        <select id="delete-expense-select">
                            {% for expense in expenses %}
                                <option value="{{ expense.id }}">{{ expense.category }}</option>
                            {% endfor %}
                        </select>

                        <div class="dialog-buttons">
                            <button id="delete-expense-btn">Delete</button>
                            <button id="cancel-delete-expense-btn">Cancel</button>
                        </div>
                    </div>
                </div>



                <!-- Sent/Receive Dialog -->
                <dialog id="expense-dialog">
                    <form method="dialog">
                        <h2 id="dialog-title">Transaction</h2>
                        <label for="dialog-expense-name">Expense Name:</label>
                        <input type="text" id="dialog-expense-name" readonly />

                        <label for="dialog-date">Date:</label>
                        <input type="date" id="dialog-date" />

                        <label for="dialog-amount">Amount:</label>
                        <input type="number" id="dialog-amount" placeholder="Enter amount" required />

                        <div class="dialog-buttons">
                            <button type="submit" id="save-transaction">Save</button>
                            <button type="button" id="cancel-transaction">Cancel</button>
                        </div>
                    </form>
                </dialog>

                <!-- Modal Dialog for Adding Account -->
                <dialog id="account-dialog" class="account-dialog">
                    <div class="dialog-content">
                        <h3>Add/Update Bank Account</h3>
                        <form id="bank-account-form" action="/add_accounts" method="POST">
                            <input type="hidden" id="account-id">
                            <div class="form-group">
                                <label for="account-name">Account Name:</label>
                                <input type="text" id="account-name" name="account_name" required>
                            </div>
                            <div class="form-group">
                                <label for="account-number">Account Number:</label>
                                <input type="text" id="account-number" name="account_number" required>
                            </div>
                            <div class="form-group">
                                <label for="bank-name">Bank Name:</label>
                                <input type="text" id="bank-name" name="bank_name" required>
                            </div>
                            <div class="form-group">
                                <label for="balance">Balance:</label>
                                <input type="number" id="balance" name="balance" required>
                            </div>
                            <div class="dialog-actions">
                                <button type="submit" class="action-button">Save Account</button>
                                <button type="button" id="cancel-dialog-btn">Cancel</button>
                            </div>
                        </form>
                    </div>
                </dialog>

                <!-- Dialog for Deleting Account -->
                <dialog id="delete-account-dialog" class="account-dialog">
                    <div class="dialog-content">
                        <h3>Delete Bank Account</h3>
                        <label for="delete-account-select">Select Account to Delete:</label>
                        <select id="delete-account-select">
                            {% for account in accounts %}
                                <option value="{{ account.id }}">{{ account.account_name }} ({{ account.bank_name }})</option>
                            {% endfor %}
                        </select>
                        <div class="dialog-actions">
                            <button type="button" id="confirm-delete-btn" class="action-button">Delete</button>
                            <button type="button" id="cancel-delete-btn" class="action-button">Cancel</button>
                        </div>
                    </div>
                </dialog>
                


                <!-- Update Balance Dialog -->
                <dialog id="update-balance-dialog" class="account-dialog">
                    <div class="dialog-content">
                        <h3>Update Balance</h3>
                        <form id="update-balance-form">
                            <!-- Account Name (Read-Only) -->
                            <div class="form-group">
                                <label for="account-name-update">Account Name:</label>
                                <input type="text" id="account-name-update" readonly>
                            </div>
                            <!-- Date -->
                            <div class="form-group">
                                <label for="update-date">Date:</label>
                                <input type="date" id="update-date" value="{{ current_date }}" readonly>
                            </div>
                            <!-- Amount -->
                            <div class="form-group">
                                <label for="update-amount">Amount:</label>
                                <input type="number" id="update-amount" name="amount" required>
                            </div>
                            <!-- Buttons -->
                            <div class="dialog-actions">
                                <button type="submit" class="action-button">Submit</button>
                                <button type="button" id="cancel-update-btn" class="action-button">Cancel</button>
                            </div>
                        </form>
                    </div>
                </dialog>

                <!-- Update Points Dialog -->
                <dialog id="update-points-dialog" class="account-dialog">
                    <div class="dialog-content">
                        <h3>Update Points</h3>
                        <form id="update-points-form">
                            <!-- Panel Name (Read-Only) -->
                            <div class="form-group">
                                <label for="update-panel-name">Panel Name:</label>
                                <input type="text" id="update-panel-name" readonly>
                            </div>
                            <!-- Date -->
                            <div class="form-group">
                                <label for="update-panel-date">Date:</label>
                                <input type="date" id="update-panel-date" required>
                            </div>
                            <!-- Points -->
                            <div class="form-group">
                                <label for="update-panel-points">Points:</label>
                                <input type="number" id="update-panel-points" name="panel-pts" required>
                            </div>
                            <!-- Buttons -->
                            <div class="dialog-actions">
                                <button type="submit" class="action-button">Submit</button>
                                <button type="button" id="cancel-update-panel-btn" class="action-button">Cancel</button>
                            </div>
                        </form>
                    </div>
                </dialog>

                <!-- Add/Withdraw Points Dialog -->
                <dialog id="add-withdraw-dialog" class="account-dialog">
                    <div class="dialog-content">
                        <h3>Add/Withdraw Points</h3>
                        <form id="add-withdraw-form">
                            <!-- Panel Name (Read-Only) -->
                            <div class="form-group">
                                <label for="aw-panel-name">Panel Name:</label>
                                <input type="text" id="aw-panel-name" readonly>
                            </div>
                            <!-- Date (Pre-filled) -->
                            <div class="form-group">
                                <label for="aw-date">Date:</label>
                                <input type="date" id="aw-date" required>
                            </div>
                            <!-- Points Input -->
                            <div class="form-group">
                                <label for="aw-points">Points:</label>
                                <input type="number" id="aw-points" required>
                            </div>
                            <!-- Add/Withdraw Radio Buttons -->
                            <div class="form-group">
                                <input type="radio" id="aw-add" name="aw-type" value="add" checked>
                                <label for="aw-add">Add</label>
                                <input type="radio" id="aw-withdraw" name="aw-type" value="withdraw">
                                <label for="aw-withdraw">Withdraw</label>
                            </div>
                            <!-- Buttons -->
                            <div class="dialog-actions">
                                <button type="submit" class="action-button">Save</button>
                                <button type="button" id="cancel-aw-btn" class="action-button">Cancel</button>
                            </div>
                        </form>
                    </div>
                </dialog>

                



            </header>
        </main>
    </div>
    <!-- External JavaScript file for event handling -->
    <script src="{{ url_for('static', filename='./worker_dashboard.js') }}" defer></script>
</body>
</html>